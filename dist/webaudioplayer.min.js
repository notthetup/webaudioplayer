/*! webaudioplayer - v0.0.0 - Wed Oct 08 2014 11:03:26 GMT+0800 (SGT) */
function WebAudioPlayer(){"use strict";window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new window.AudioContext,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.onLoadComplete=null;var e=[],o=this.audioContext.createGain();o.connect(this.audioContext.destination);var t=null;Object.defineProperty(this,"source",{enumerable:!0,configurable:!1,set:function(e){getAudio(e,function(e,o){t=o,"function"==typeof this.onLoadComplete&&this.onLoadComplete(e)},null,this.audioContext)},get:function(){return t}});var n=1;Object.defineProperty(this,"speed",{enumerable:!0,configurable:!1,set:function(o){e.forEach(function(e){e.source.playbackRate.value=o,o=e.source.playbackRate.value}),n=o},get:function(){return n}})}function getAudio(e,o,t,n){"use strict";function i(e,o,t){e.decodeAudioData(u.response,function(e){"function"==typeof t&&t(null,e)},function(){"function"==typeof t&&t(new Error("Decoding Error"),null)})}n||(window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext);var r=Object.prototype.toString.call(e);if("[object String]"===r){var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=function(){i(n,u.response,o)},u.onerror=function(){"function"==typeof o&&o(new Error("Loading Error"),null)},u.onprogress=function(e){"function"==typeof t&&t(e)},u.send()}else if("[object File]"===r){var s=new FileReader;s.onload=function(){i(n,s.result,o)},s.addEventListener("progress",t,!1),s.readAsArrayBuffer(e)}else"[object AudioBuffer]"===r&&"function"==typeof o&&o(null,e)}WebAudioPlayer.prototype.start=function(e,o,t){"use strict";function n(e){return function(){sourceNodes.forEach(function(o,t){o.index===e&&sourceNodes.splice(1,t)})}}sourceBuffer||console.warn("The sound hasn't loaded yet"),newSourceNode=this.audioContext.createBufferSource(),newSourceNode.source=sourceBuffer,newSourceNode.loop=this.loop,newSourceNode.loopStart=this.loopStart,newSourceNode.loopEnd=this.loopEnd,newSourceNode.playbackRate=playbackRateValue,newSourceNode.onend=n(++nodeCount),sourceNodes.push({source:newSourceNode,index:nodeCount}),newSourceNode.connect(releaseGainNode),newSourceNode.start(e,o,t)},WebAudioPlayer.prototype.stop=function(e){"use strict";sourceNodes.forEach(function(o){o.source.stop(e)})},WebAudioPlayer.prototype.release=function(e){"use strict";var o=.5,t=1/this.audioContext.sampleRate;this.releaseGainNode.gain.cancelScheduledValues(e),this.releaseGainNode.gain.setValueAtTime(this.volume,e),this.releaseGainNode.gain.linearRampToValueAtTime(0,e+o),this.stop(e+o+t)};